version: 1
frontend:
  phases:
    preBuild:
      commands:
        - "npm ci"
        - "echo '=== DEBUG: Checking Environment ==='"
        - "python3 --version"
        - "echo '=== DEBUG: Starting Install ==='"
        - "python3 -m pip install --upgrade pip --no-cache-dir"
        # Install libraries LOCALLY into tacrolimus-service/libs so they are bundled
        - "mkdir -p tacrolimus-service/libs"
        - "python3 -m pip install numpy pandas scikit-learn -t tacrolimus-service/libs --no-cache-dir"
        - "python3 -m pip install torch --index-url https://download.pytorch.org/whl/cpu -t tacrolimus-service/libs --no-cache-dir"
        - "echo '=== DEBUG: PreBuild Complete ==='"
    build:
      commands:
        - "npm run build"
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
